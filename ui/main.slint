// Main window UI definition for EasyHDR
// Enhanced with modern, elegant visual design

import { Button, ListView, CheckBox, Palette, StyleMetrics, Slider, ScrollView } from "std-widgets.slint";

// Modern color constants for enhanced visual design
global DesignTokens {
    // Brand colors
    out property <color> brand-primary: #4A90E2;
    out property <color> brand-primary-dark: #357ABD;
    out property <color> brand-accent: #5DA3F5;

    // Status colors - vibrant but not overwhelming
    out property <color> status-success: #10B981;
    out property <color> status-success-glow: #10B98140;
    out property <color> status-error: #EF4444;
    out property <color> status-error-glow: #EF444440;

    // Neutral colors for layering and depth
    out property <color> surface-primary: #FFFFFF;
    out property <color> surface-secondary: #F8FAFC;
    out property <color> surface-tertiary: #F1F5F9;
    out property <color> border-light: #E2E8F0;
    out property <color> border-medium: #CBD5E1;

    // Text colors for proper contrast and readability
    out property <color> text-primary: #1E293B;      // Dark slate for primary text
    out property <color> text-secondary: #475569;    // Medium slate for secondary text
    out property <color> text-tertiary: #64748B;     // Light slate for tertiary/hint text
    out property <color> text-on-primary: #FFFFFF;   // White text on primary backgrounds

    // Shadow colors for depth
    out property <color> shadow-light: #00000010;
    out property <color> shadow-medium: #00000020;
    out property <color> shadow-strong: #00000030;

    // Typography
    out property <string> font-family-primary: "Segoe UI";
    out property <length> font-size-xs: 10px;
    out property <length> font-size-sm: 11px;
    out property <length> font-size-base: 13px;
    out property <length> font-size-lg: 14px;
    out property <length> font-size-xl: 16px;
    out property <length> font-size-2xl: 20px;
    out property <length> font-size-3xl: 24px;

    // Spacing scale
    out property <length> space-xs: 4px;
    out property <length> space-sm: 8px;
    out property <length> space-md: 12px;
    out property <length> space-lg: 16px;
    out property <length> space-xl: 20px;
    out property <length> space-2xl: 24px;

    // Border radius scale
    out property <length> radius-sm: 6px;
    out property <length> radius-md: 8px;
    out property <length> radius-lg: 12px;
    out property <length> radius-xl: 16px;
}

// AppListItem struct represents a configured application in the list
// Fields: id (UUID), display-name (app name), exe-path (full path), enabled (checkbox state), icon (app icon)
export struct AppListItem {
    id: string,
    display-name: string,
    exe-path: string,
    enabled: bool,
    icon: image,
}

// UwpPackageListItem struct represents a UWP package in the picker dialog
// Fields: display-name (app name), publisher (publisher name), icon (app icon), selected (checkbox state)
export struct UwpPackageListItem {
    display-name: string,
    publisher: string,
    package-family-name: string,
    app-id: string,
    icon: image,
    selected: bool,
}

// Custom styled button component with guaranteed text contrast
component StyledButton inherits Rectangle {
    in property <string> text;
    in property <bool> enabled: true;
    in property <bool> primary: false;
    callback clicked;

    // Modern button styling with proper contrast
    height: 32px;
    border-radius: DesignTokens.radius-sm;
    background: primary ?
        (touch-area.pressed ? DesignTokens.brand-primary-dark :
         (touch-area.has-hover ? DesignTokens.brand-primary : DesignTokens.brand-primary)) :
        (touch-area.pressed ? DesignTokens.surface-tertiary :
         (touch-area.has-hover ? DesignTokens.surface-secondary : DesignTokens.surface-primary));
    border-width: primary ? 0px : 1px;
    border-color: DesignTokens.border-medium;

    // Smooth transitions
    animate background {
        duration: 150ms;
        easing: ease-in-out;
    }

    touch-area := TouchArea {
        enabled: root.enabled;
        clicked => {
            root.clicked();
        }
    }

    HorizontalLayout {
        padding-left: DesignTokens.space-lg;
        padding-right: DesignTokens.space-lg;

        Text {
            text: root.text;
            font-family: DesignTokens.font-family-primary;
            color: root.enabled ?
                (primary ? DesignTokens.text-on-primary : DesignTokens.text-primary) :
                DesignTokens.text-tertiary;
            font-size: DesignTokens.font-size-base;
            font-weight: primary ? 600 : 400;
            horizontal-alignment: center;
            vertical-alignment: center;
        }
    }
}

// Custom styled checkbox component with guaranteed text contrast
component StyledCheckBox inherits HorizontalLayout {
    in property <string> text;
    in-out property <bool> checked: false;
    callback toggled;

    spacing: DesignTokens.space-md;

    CheckBox {
        checked <=> root.checked;
        toggled => {
            root.toggled();
        }
    }

    Text {
        text: root.text;
        font-family: DesignTokens.font-family-primary;
        color: DesignTokens.text-primary;
        font-size: DesignTokens.font-size-base;
        vertical-alignment: center;
    }
}

// Settings dialog content component
// Provides UI for configuring user preferences with modern, elegant styling
component SettingsDialogContent inherits Rectangle {
    // Properties for settings values
    in-out property <bool> auto-start: false;
    in-out property <int> monitoring-interval-ms: 1000;
    in-out property <bool> show-tray-notifications: true;
    in-out property <bool> show-update-notifications: true;
    in-out property <bool> minimize-to-tray-on-minimize: true;
    in-out property <bool> minimize-to-tray-on-close: false;
    in-out property <bool> start-minimized-to-tray: false;

    // Callbacks
    callback save-settings(bool, int, bool, bool, bool, bool, bool);
    callback cancel-settings();

    // Modern card-like design with layered shadows
    background: DesignTokens.surface-primary;
    border-width: 1px;
    border-color: DesignTokens.border-light;
    border-radius: DesignTokens.radius-xl;
    drop-shadow-blur: 20px;
    drop-shadow-color: DesignTokens.shadow-medium;
    drop-shadow-offset-y: 4px;

        VerticalLayout {
            padding: DesignTokens.space-2xl;
            spacing: 0px;

            // Title with modern typography
            Text {
                text: "Settings";
                font-family: DesignTokens.font-family-primary;
                font-size: DesignTokens.font-size-3xl;
                font-weight: 700;
                color: DesignTokens.text-primary;
            }

            // Spacing after title
            Rectangle {
                height: DesignTokens.space-xl;
            }

            // Scrollable settings content
            ScrollView {
                vertical-stretch: 1;

                VerticalLayout {
                    spacing: DesignTokens.space-xl;
                    padding-right: DesignTokens.space-sm;

                    // Category 1: System Integration
                    VerticalLayout {
                        spacing: DesignTokens.space-md;

                // Section header
                Text {
                    text: "System Integration";
                    font-family: DesignTokens.font-family-primary;
                    font-size: DesignTokens.font-size-lg;
                    font-weight: 600;
                    color: DesignTokens.text-primary;
                }

                // Settings in this category
                VerticalLayout {
                    spacing: DesignTokens.space-md;

                    // Auto-start setting
                    StyledCheckBox {
                        text: "Auto-start on Windows login";
                        checked <=> auto-start;
                    }

                    // Start minimized to tray setting
                    StyledCheckBox {
                        text: "Start minimized to tray on launch";
                        checked <=> start-minimized-to-tray;
                    }

                    // Minimize button behavior setting
                    StyledCheckBox {
                        text: "Minimize to tray (instead of taskbar)";
                        checked <=> minimize-to-tray-on-minimize;
                    }

                    // Close button behavior setting
                    StyledCheckBox {
                        text: "Close to tray (instead of exiting)";
                        checked <=> minimize-to-tray-on-close;
                    }
                }
            }

            // Visual separator
            Rectangle {
                height: 1px;
                background: DesignTokens.border-light;
            }

            // Category 2: Monitoring & Performance
            VerticalLayout {
                spacing: DesignTokens.space-md;

                // Section header
                Text {
                    text: "Monitoring & Performance";
                    font-family: DesignTokens.font-family-primary;
                    font-size: DesignTokens.font-size-lg;
                    font-weight: 600;
                    color: DesignTokens.text-primary;
                }

                // Monitoring interval setting
                VerticalLayout {
                    spacing: DesignTokens.space-sm;
                    Text {
                        text: "Monitoring interval: " + round(monitoring-interval-ms) + "ms";
                        font-family: DesignTokens.font-family-primary;
                        color: DesignTokens.text-primary;
                        font-size: DesignTokens.font-size-base;
                        font-weight: 600;
                    }
                    HorizontalLayout {
                        spacing: DesignTokens.space-md;
                        Text {
                            text: "500ms";
                            font-family: DesignTokens.font-family-primary;
                            color: DesignTokens.text-secondary;
                            font-size: DesignTokens.font-size-sm;
                            vertical-alignment: center;
                        }
                        Slider {
                            minimum: 500;
                            maximum: 2000;
                            value: monitoring-interval-ms;
                            horizontal-stretch: 1;
                            changed(value) => {
                                monitoring-interval-ms = round(value);
                            }
                        }
                        Text {
                            text: "2000ms";
                            font-family: DesignTokens.font-family-primary;
                            color: DesignTokens.text-secondary;
                            font-size: DesignTokens.font-size-sm;
                            vertical-alignment: center;
                        }
                    }
                }
            }

            // Visual separator
            Rectangle {
                height: 1px;
                background: DesignTokens.border-light;
            }

            // Category 3: Notifications & Feedback
            VerticalLayout {
                spacing: DesignTokens.space-md;

                // Section header
                Text {
                    text: "Notifications & Feedback";
                    font-family: DesignTokens.font-family-primary;
                    font-size: DesignTokens.font-size-lg;
                    font-weight: 600;
                    color: DesignTokens.text-primary;
                }

                // Settings in this category
                VerticalLayout {
                    spacing: DesignTokens.space-md;

                    // Tray notifications setting
                    StyledCheckBox {
                        text: "Show tray notifications on HDR changes";
                        checked <=> show-tray-notifications;
                    }

                    // Update notifications setting
                    StyledCheckBox {
                        text: "Show notifications when updates are available";
                        checked <=> show-update-notifications;
                    }
                }
            }
                }
            }

            // Spacing before buttons
            Rectangle {
                height: DesignTokens.space-xl;
            }

            // Dialog buttons with modern spacing
            HorizontalLayout {
                spacing: DesignTokens.space-md;

                // Spacer to push buttons to the right
                Rectangle {
                    horizontal-stretch: 1;
                }

                StyledButton {
                    text: "Cancel";
                    clicked => {
                        cancel-settings();
                    }
                }
                StyledButton {
                    text: "Save";
                    primary: true;
                    clicked => {
                        save-settings(auto-start, monitoring-interval-ms, show-tray-notifications, show-update-notifications, minimize-to-tray-on-minimize, minimize-to-tray-on-close, start-minimized-to-tray);
                    }
                }
            }
        }
    }

// UWP Package Picker Dialog Content
// Provides UI for selecting UWP applications to add to the monitored app list
component UwpPickerDialogContent inherits Rectangle {
    // Properties
    in-out property <[UwpPackageListItem]> package-list: [];
    in-out property <bool> loading: false;
    in-out property <string> error-message: "";

    // Callbacks
    callback add-selected-packages();
    callback cancel-picker();
    callback toggle-package-selection(int, bool);
    callback select-all();
    callback deselect-all();

    // Modern card-like design with layered shadows
    background: DesignTokens.surface-primary;
    border-width: 1px;
    border-color: DesignTokens.border-light;
    border-radius: DesignTokens.radius-xl;
    drop-shadow-blur: 20px;
    drop-shadow-color: DesignTokens.shadow-medium;
    drop-shadow-offset-y: 4px;

    VerticalLayout {
        padding: DesignTokens.space-2xl;
        spacing: 0px;

        // Title with modern typography
        Text {
            text: "Add UWP Applications";
            font-family: DesignTokens.font-family-primary;
            font-size: DesignTokens.font-size-3xl;
            font-weight: 700;
            color: DesignTokens.text-primary;
        }

        // Subtitle
        Text {
            text: "Select one or more UWP applications from the Microsoft Store";
            font-family: DesignTokens.font-family-primary;
            font-size: DesignTokens.font-size-sm;
            color: DesignTokens.text-secondary;
        }

        // Spacing after title
        Rectangle {
            height: DesignTokens.space-xl;
        }

        // Loading state
        if loading: VerticalLayout {
            spacing: DesignTokens.space-md;
            padding: DesignTokens.space-2xl;

            Text {
                text: "Loading UWP applications...";
                font-family: DesignTokens.font-family-primary;
                font-size: DesignTokens.font-size-base;
                color: DesignTokens.text-secondary;
                horizontal-alignment: center;
            }
        }

        // Error state
        if !loading && error-message != "": VerticalLayout {
            spacing: DesignTokens.space-md;
            padding: DesignTokens.space-2xl;

            Text {
                text: "‚ö†Ô∏è Error Loading Applications";
                font-family: DesignTokens.font-family-primary;
                font-size: DesignTokens.font-size-lg;
                font-weight: 600;
                color: DesignTokens.status-error;
                horizontal-alignment: center;
            }

            Text {
                text: error-message;
                font-family: DesignTokens.font-family-primary;
                font-size: DesignTokens.font-size-sm;
                color: DesignTokens.text-secondary;
                horizontal-alignment: center;
                wrap: word-wrap;
            }
        }

        // Package list (when loaded successfully)
        if !loading && error-message == "": VerticalLayout {
            spacing: DesignTokens.space-md;
            vertical-stretch: 1;

            // Selection controls
            HorizontalLayout {
                spacing: DesignTokens.space-md;

                Text {
                    text: package-list.length + " application(s) found";
                    font-family: DesignTokens.font-family-primary;
                    font-size: DesignTokens.font-size-sm;
                    color: DesignTokens.text-secondary;
                    vertical-alignment: center;
                }

                Rectangle {
                    horizontal-stretch: 1;
                }

                StyledButton {
                    text: "Select All";
                    clicked => {
                        select-all();
                    }
                }

                StyledButton {
                    text: "Deselect All";
                    clicked => {
                        deselect-all();
                    }
                }
            }

            // Scrollable package list
            Rectangle {
                border-width: 1px;
                border-color: DesignTokens.border-light;
                border-radius: DesignTokens.radius-md;
                background: DesignTokens.surface-secondary;
                vertical-stretch: 1;

                ScrollView {
                    ListView {
                        for item[index] in package-list: Rectangle {
                            // Modern list item with hover state
                            border-radius: DesignTokens.radius-sm;
                            background: touch-area.has-hover ? DesignTokens.surface-tertiary : Colors.transparent;

                            // Smooth transitions
                            animate background {
                                duration: 200ms;
                                easing: ease-in-out;
                            }

                            // Touch area for row interactions
                            touch-area := TouchArea {
                                clicked => {
                                    toggle-package-selection(index, !item.selected);
                                }
                            }

                            HorizontalLayout {
                                spacing: DesignTokens.space-md;
                                padding: DesignTokens.space-md;

                                // Selection checkbox
                                CheckBox {
                                    checked: item.selected;
                                    toggled => {
                                        toggle-package-selection(index, self.checked);
                                    }
                                }

                                // Application icon
                                Rectangle {
                                    width: 32px;
                                    height: 32px;
                                    border-radius: DesignTokens.radius-sm;
                                    background: DesignTokens.surface-primary;

                                    Image {
                                        source: item.icon;
                                        width: 28px;
                                        height: 28px;
                                        x: 2px;
                                        y: 2px;
                                        image-fit: contain;
                                    }
                                }

                                // Application details
                                VerticalLayout {
                                    spacing: DesignTokens.space-xs;
                                    horizontal-stretch: 1;

                                    Text {
                                        text: item.display-name;
                                        font-family: DesignTokens.font-family-primary;
                                        font-weight: 600;
                                        font-size: DesignTokens.font-size-base;
                                        overflow: elide;
                                        color: DesignTokens.text-primary;
                                    }

                                    Text {
                                        text: item.publisher;
                                        font-family: DesignTokens.font-family-primary;
                                        font-size: DesignTokens.font-size-sm;
                                        color: DesignTokens.text-secondary;
                                        overflow: elide;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        // Spacing before buttons
        Rectangle {
            height: DesignTokens.space-xl;
        }

        // Dialog buttons
        HorizontalLayout {
            spacing: DesignTokens.space-md;

            // Spacer to push buttons to the right
            Rectangle {
                horizontal-stretch: 1;
            }

            StyledButton {
                text: "Cancel";
                clicked => {
                    cancel-picker();
                }
            }

            StyledButton {
                text: "Add Selected";
                primary: true;
                enabled: !loading && error-message == "";
                clicked => {
                    add-selected-packages();
                }
            }
        }
    }
}

export component MainWindow inherits Window {
    title: "EasyHDR";
    icon: @image-url("../assets/icon.ico");
    preferred-width: 650px;
    preferred-height: 550px;
    default-font-family: "Segoe UI";

    // Properties
    in-out property <[AppListItem]> app-list: [];
    in-out property <bool> hdr-enabled: false;
    in-out property <int> selected-index: -1;

    // Settings properties (synced with backend)
    in-out property <bool> settings-auto-start: false;
    in-out property <int> settings-monitoring-interval-ms: 1000;
    in-out property <bool> settings-show-tray-notifications: true;
    in-out property <bool> settings-show-update-notifications: true;
    in-out property <bool> settings-minimize-to-tray-on-minimize: true;
    in-out property <bool> settings-minimize-to-tray-on-close: false;
    in-out property <bool> settings-start-minimized-to-tray: false;

    // Version and update check properties
    in-out property <string> app-version: "0.1.0";
    in-out property <string> build-id: "unknown";
    in-out property <bool> checking-for-updates: false;

    // UWP picker properties
    in-out property <[UwpPackageListItem]> uwp-package-list: [];
    in-out property <bool> uwp-picker-loading: false;
    in-out property <string> uwp-picker-error: "";

    // Callbacks
    callback add-application();
    callback add-uwp-application();
    callback remove-application(int);
    callback toggle-enabled(int, bool);
    callback open-settings();
    callback save-settings(bool, int, bool, bool, bool, bool, bool);
    callback check-for-updates();

    // UWP picker callbacks
    callback uwp-picker-add-selected();
    callback uwp-picker-cancel();
    callback uwp-picker-toggle-selection(int, bool);
    callback uwp-picker-select-all();
    callback uwp-picker-deselect-all();

    // Modern background with subtle gradient
    background: DesignTokens.surface-secondary;

    VerticalLayout {
        padding: 0px;
        spacing: 0px;

        // Modern header with branding and HDR status
        Rectangle {
            height: 80px;
            background: @linear-gradient(180deg, DesignTokens.brand-primary 0%, DesignTokens.brand-primary-dark 100%);
            drop-shadow-blur: 8px;
            drop-shadow-color: DesignTokens.shadow-light;
            drop-shadow-offset-y: 2px;

            HorizontalLayout {
                padding-left: DesignTokens.space-xl;
                padding-right: DesignTokens.space-xl;
                padding-top: DesignTokens.space-lg;
                padding-bottom: DesignTokens.space-lg;
                spacing: DesignTokens.space-lg;

                // App icon and title
                HorizontalLayout {
                    spacing: DesignTokens.space-md;

                    Image {
                        source: @image-url("../assets/icon.ico");
                        width: 48px;
                        height: 48px;
                        image-fit: contain;
                    }

                    VerticalLayout {
                        spacing: DesignTokens.space-xs;

                        Text {
                            text: "EasyHDR";
                            font-family: DesignTokens.font-family-primary;
                            font-size: DesignTokens.font-size-2xl;
                            font-weight: 700;
                            color: #FFFFFF;
                        }

                        Text {
                            text: "HDR Management Made Easy";
                            font-family: DesignTokens.font-family-primary;
                            font-size: DesignTokens.font-size-sm;
                            color: #FFFFFF.transparentize(0.3);
                        }
                    }
                }

                // Spacer
                Rectangle {
                    horizontal-stretch: 1;
                }

                // Enhanced HDR Status indicator with glow effect
                Rectangle {
                    width: 180px;
                    height: 56px;
                    border-radius: DesignTokens.radius-lg;
                    background: #FFFFFF.transparentize(0.9);
                    border-width: 1px;
                    border-color: #FFFFFF.transparentize(0.7);

                    HorizontalLayout {
                        padding: DesignTokens.space-md;
                        spacing: DesignTokens.space-md;

                        // Status indicator with animated glow
                        Rectangle {
                            width: 32px;
                            height: 32px;
                            border-radius: 16px;
                            background: hdr-enabled ? DesignTokens.status-success : DesignTokens.status-error;
                            drop-shadow-blur: 12px;
                            drop-shadow-color: hdr-enabled ? DesignTokens.status-success-glow : DesignTokens.status-error-glow;

                            animate background {
                                duration: 300ms;
                                easing: ease-in-out;
                            }
                        }

                        VerticalLayout {
                            spacing: 2px;

                            Text {
                                text: "HDR Status";
                                font-family: DesignTokens.font-family-primary;
                                font-size: DesignTokens.font-size-xs;
                                color: #FFFFFF.transparentize(0.3);
                            }

                            Text {
                                text: hdr-enabled ? "ENABLED" : "DISABLED";
                                font-family: DesignTokens.font-family-primary;
                                font-size: DesignTokens.font-size-lg;
                                font-weight: 700;
                                color: #FFFFFF;
                            }
                        }
                    }
                }
            }
        }

        // Main content area
        VerticalLayout {
            padding: DesignTokens.space-xl;
            spacing: DesignTokens.space-lg;

            // Application list card with modern styling
            Rectangle {
                border-width: 1px;
                border-color: DesignTokens.border-light;
                border-radius: DesignTokens.radius-lg;
                background: DesignTokens.surface-primary;
                drop-shadow-blur: 8px;
                drop-shadow-color: DesignTokens.shadow-light;
                drop-shadow-offset-y: 2px;

                // Empty state with better styling
                if app-list.length == 0: VerticalLayout {
                    padding: DesignTokens.space-2xl;
                    spacing: DesignTokens.space-md;

                    Text {
                        text: "No Applications Configured";
                        font-family: DesignTokens.font-family-primary;
                        horizontal-alignment: center;
                        font-size: DesignTokens.font-size-xl;
                        font-weight: 600;
                        color: DesignTokens.text-secondary;
                    }

                    Text {
                        text: "Click 'Add Application(s)' below to get started";
                        font-family: DesignTokens.font-family-primary;
                        horizontal-alignment: center;
                        font-size: DesignTokens.font-size-base;
                        color: DesignTokens.text-tertiary;
                    }
                }

                // Scrollable ListView with modern card items
                if app-list.length > 0: ListView {
                    for item[index] in app-list: Rectangle {
                        // Modern list item with hover and selection states
                        border-radius: DesignTokens.radius-md;
                        background: selected-index == index ?
                            DesignTokens.brand-primary.transparentize(0.9) :
                            (touch-area.has-hover ? DesignTokens.surface-tertiary : Colors.transparent);

                        // Smooth transitions
                        animate background {
                            duration: 200ms;
                            easing: ease-in-out;
                        }

                        // Touch area for row interactions
                        touch-area := TouchArea {
                            clicked => {
                                selected-index = index;
                            }
                        }

                        HorizontalLayout {
                            spacing: DesignTokens.space-md;
                            padding: DesignTokens.space-md;

                            // Application icon with subtle shadow
                            Rectangle {
                                width: 40px;
                                height: 40px;
                                border-radius: DesignTokens.radius-sm;
                                background: DesignTokens.surface-secondary;

                                Image {
                                    source: item.icon;
                                    width: 36px;
                                    height: 36px;
                                    x: 2px;
                                    y: 2px;
                                    image-fit: contain;
                                }
                            }

                            // Application details with improved typography
                            VerticalLayout {
                                spacing: DesignTokens.space-xs;

                                Text {
                                    text: item.display-name;
                                    font-family: DesignTokens.font-family-primary;
                                    font-weight: 600;
                                    font-size: DesignTokens.font-size-base;
                                    overflow: elide;
                                    color: DesignTokens.text-primary;
                                }
                                Text {
                                    text: item.exe-path;
                                    font-family: DesignTokens.font-family-primary;
                                    font-size: DesignTokens.font-size-sm;
                                    color: DesignTokens.text-secondary;
                                    overflow: elide;
                                }
                            }

                            // Spacer to push checkbox to the right
                            Rectangle {
                                horizontal-stretch: 1;
                            }

                            // Enabled checkbox
                            CheckBox {
                                checked: item.enabled;
                                toggled => {
                                    toggle-enabled(index, self.checked);
                                }
                            }
                        }
                    }
                }
            }

            // Modern action toolbar
            HorizontalLayout {
                spacing: DesignTokens.space-md;

                StyledButton {
                    text: "Add Application(s)";
                    primary: true;
                    clicked => {
                        add-application();
                    }
                }
                StyledButton {
                    text: "Add UWP Application";
                    primary: true;
                    clicked => {
                        add-uwp-application();
                        uwp-picker-dialog.show();
                    }
                }
                StyledButton {
                    text: "Remove Selected";
                    enabled: selected-index >= 0;
                    clicked => {
                        remove-application(selected-index);
                    }
                }

                // Spacer
                Rectangle {
                    horizontal-stretch: 1;
                }

                // Settings button
                StyledButton {
                    text: "Settings";
                    clicked => {
                        settings-dialog.show();
                    }
                }
            }

            // Helpful tip with modern styling
            Rectangle {
                height: 40px;
                border-radius: DesignTokens.radius-md;
                background: DesignTokens.brand-accent.transparentize(0.9);
                border-width: 1px;
                border-color: DesignTokens.brand-accent.transparentize(0.7);

                HorizontalLayout {
                    padding: DesignTokens.space-md;
                    spacing: DesignTokens.space-sm;

                    Text {
                        text: "üí°";
                        font-family: DesignTokens.font-family-primary;
                        font-size: DesignTokens.font-size-lg;
                    }

                    Text {
                        text: "Tip: You can select multiple .exe files at once using the file dialog";
                        font-family: DesignTokens.font-family-primary;
                        font-size: DesignTokens.font-size-sm;
                        color: DesignTokens.text-secondary;
                    }
                }
            }

            // Version display and update check button (lower right corner)
            HorizontalLayout {
                spacing: DesignTokens.space-md;

                // Spacer to push version info to the right
                Rectangle {
                    horizontal-stretch: 1;
                }

                // Version display
                Text {
                    text: "v" + app-version + " (" + build-id + ")";
                    font-family: DesignTokens.font-family-primary;
                    font-size: DesignTokens.font-size-xs;
                    color: DesignTokens.text-tertiary;
                    vertical-alignment: center;
                }

                // Update check button (small, minimal)
                Rectangle {
                    width: 24px;
                    height: 24px;
                    border-radius: DesignTokens.radius-sm;
                    background: update-check-touch.has-hover ?
                        DesignTokens.surface-tertiary :
                        Colors.transparent;
                    border-width: 1px;
                    border-color: update-check-touch.has-hover ?
                        DesignTokens.border-medium :
                        Colors.transparent;

                    animate background, border-color {
                        duration: 150ms;
                        easing: ease-in-out;
                    }

                    update-check-touch := TouchArea {
                        enabled: !checking-for-updates;
                        clicked => {
                            check-for-updates();
                        }
                    }

                    // Refresh icon (Unicode character)
                    Text {
                        text: checking-for-updates ? "‚è≥" : "üîÑ";
                        font-family: DesignTokens.font-family-primary;
                        font-size: DesignTokens.font-size-sm;
                        color: DesignTokens.text-secondary;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
            }
        }
    }

    // Settings dialog popup
    settings-dialog := PopupWindow {
        x: (parent.width - 500px) / 2;
        y: (parent.height - 500px) / 2;
        width: 500px;
        height: 500px;
        close-policy: PopupClosePolicy.no-auto-close;

        SettingsDialogContent {
            auto-start <=> settings-auto-start;
            monitoring-interval-ms <=> settings-monitoring-interval-ms;
            show-tray-notifications <=> settings-show-tray-notifications;
            show-update-notifications <=> settings-show-update-notifications;
            minimize-to-tray-on-minimize <=> settings-minimize-to-tray-on-minimize;
            minimize-to-tray-on-close <=> settings-minimize-to-tray-on-close;
            start-minimized-to-tray <=> settings-start-minimized-to-tray;

            save-settings(auto-start, monitoring-interval-ms, show-tray-notifications, show-update-notifications, minimize-to-tray-on-minimize, minimize-to-tray-on-close, start-minimized-to-tray) => {
                root.save-settings(auto-start, monitoring-interval-ms, show-tray-notifications, show-update-notifications, minimize-to-tray-on-minimize, minimize-to-tray-on-close, start-minimized-to-tray);
                settings-dialog.close();
            }

            cancel-settings => {
                settings-dialog.close();
            }
        }
    }

    // UWP package picker dialog popup
    uwp-picker-dialog := PopupWindow {
        x: (parent.width - 600px) / 2;
        y: (parent.height - 550px) / 2;
        width: 600px;
        height: 550px;
        close-policy: PopupClosePolicy.no-auto-close;

        UwpPickerDialogContent {
            package-list <=> uwp-package-list;
            loading <=> uwp-picker-loading;
            error-message <=> uwp-picker-error;

            add-selected-packages => {
                root.uwp-picker-add-selected();
                uwp-picker-dialog.close();
            }

            cancel-picker => {
                root.uwp-picker-cancel();
                uwp-picker-dialog.close();
            }

            toggle-package-selection(index, selected) => {
                root.uwp-picker-toggle-selection(index, selected);
            }

            select-all => {
                root.uwp-picker-select-all();
            }

            deselect-all => {
                root.uwp-picker-deselect-all();
            }
        }
    }
}

