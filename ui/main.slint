// Main window UI definition for EasyHDR
// Implements task 9.1: Create main window UI definition
// Implements task 9.4: Theme support with Palette and StyleMetrics
// Requirements: 5.1, 5.2, 5.3, 5.4, 5.8, 5.9, 5.13

import { Button, ListView, CheckBox, Palette, StyleMetrics } from "std-widgets.slint";

// AppListItem struct represents a configured application in the list
// Fields: id (UUID), display-name (app name), exe-path (full path), enabled (checkbox state), icon (app icon)
export struct AppListItem {
    id: string,
    display-name: string,
    exe-path: string,
    enabled: bool,
    icon: image,
}

export component MainWindow inherits Window {
    title: "EasyHDR";
    preferred-width: 600px;
    preferred-height: 500px;

    // Properties
    in-out property <[AppListItem]> app-list: [];
    in-out property <bool> hdr-enabled: false;
    in-out property <int> selected-index: -1;

    // Callbacks
    callback add-application();
    callback remove-application(int);
    callback toggle-enabled(int, bool);
    callback minimize-to-tray();

    VerticalLayout {
        padding: StyleMetrics.layout-padding;
        spacing: StyleMetrics.layout-spacing;

        // HDR Status indicator (Requirement 5.8, 5.13)
        // Shows colored circle (green for ON, red for OFF) and text label
        // Theme-aware colors with clear ON/OFF distinction
        HorizontalLayout {
            spacing: StyleMetrics.layout-spacing;
            Text {
                text: "HDR Status:";
                font-size: 14px;
                color: Palette.foreground;
            }
            Rectangle {
                width: 16px;
                height: 16px;
                border-radius: 8px;
                // Use semantic colors: success green for ON, error red for OFF
                background: hdr-enabled ? #00cc00 : #cc0000;
            }
            Text {
                text: hdr-enabled ? "ON" : "OFF";
                font-size: 14px;
                font-weight: 700;
                color: Palette.foreground;
            }
        }

        // Application list container (Requirements 5.2, 5.3, 5.4, 5.13)
        // Task 9.2: Implement application list display with proper styling
        // Task 9.4: Theme-aware colors and spacing
        Rectangle {
            border-width: 1px;
            border-color: Palette.border;
            border-radius: 4px;
            background: Palette.alternate-background;

            // Empty state message (Requirement 5.4)
            if app-list.length == 0: Text {
                text: "No applications configured. Click 'Add Application' to get started.";
                horizontal-alignment: center;
                vertical-alignment: center;
                color: Palette.foreground;
            }

            // Scrollable ListView for application list (Requirements 5.2, 5.3, 5.13)
            if app-list.length > 0: ListView {
                for item[index] in app-list: VerticalLayout {
                    // List item row with visual highlight for selection
                    Rectangle {
                        // Visual highlight for selected row - theme-aware
                        background: selected-index == index ? Palette.selection-background : Colors.transparent;

                        // Touch area for row click handling - covers entire row
                        TouchArea {
                            clicked => {
                                selected-index = index;
                            }
                        }

                        HorizontalLayout {
                            spacing: StyleMetrics.layout-spacing;
                            padding: StyleMetrics.layout-padding;

                            // Application icon (32x32)
                            Image {
                                source: item.icon;
                                width: 32px;
                                height: 32px;
                            }

                            // Application name and path with truncation
                            VerticalLayout {
                                spacing: 2px;

                                Text {
                                    text: item.display-name;
                                    font-weight: 600;
                                    font-size: 13px;
                                    overflow: elide;
                                    color: Palette.foreground;
                                }
                                Text {
                                    text: item.exe-path;
                                    font-size: 11px;
                                    color: Palette.foreground.transparentize(0.4);
                                    overflow: elide;
                                }
                            }

                            // Spacer to push checkbox to the right
                            Rectangle {
                                horizontal-stretch: 1;
                            }

                            // Enabled checkbox aligned to the right
                            CheckBox {
                                checked: item.enabled;
                                toggled => {
                                    toggle-enabled(index, self.checked);
                                }
                            }
                        }
                    }

                    // Row separator line - theme-aware
                    Rectangle {
                        height: 1px;
                        background: Palette.border;
                    }
                }
            }
        }

        // Bottom toolbar with buttons (Requirement 5.9, 5.13, 5.14)
        // Theme-aware spacing
        HorizontalLayout {
            spacing: StyleMetrics.layout-spacing;
            Button {
                text: "Add Application(s)";
                clicked => {
                    add-application();
                }
            }
            Button {
                text: "Remove Selected";
                enabled: selected-index >= 0;
                clicked => {
                    remove-application(selected-index);
                }
            }
        }

        // Drag-and-drop hint (Requirement 5.14)
        // Inform users about drag-and-drop functionality
        Text {
            text: "Tip: You can select multiple .exe files at once using the file dialog";
            font-size: 11px;
            color: Palette.foreground.transparentize(0.5);
            horizontal-alignment: center;
        }
    }
}

